<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´§ç‰©è§£ææµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 120px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš› è´§ç‰©è§£ææµ‹è¯•å·¥å…·</h1>

        <div>
            <h3>æµ‹è¯•è¾“å…¥ï¼š</h3>
            <textarea id="cargoInput" placeholder="è¯·è¾“å…¥è´§ç‰©ä¿¡æ¯...">è´§åœ¨æ·±åœ³  -TAS  4ä»¶/8.95æ–¹/1210kg
å°ºå¯¸1336*706*2005*2ä»¶
2546*781*1300*2ä»¶
å°ºå¯¸mm</textarea>
        </div>

        <div>
            <button onclick="testParsing()">ğŸ” æµ‹è¯•è§£æ</button>
            <button onclick="loadSample1()">ğŸ“¦ æ ·æœ¬1: å¤šå°ºå¯¸æ ¼å¼</button>
            <button onclick="loadSample2()">ğŸ“‹ æ ·æœ¬2: å¤šè¡Œæè¿°</button>
            <button onclick="loadSample3()">ğŸ¯ æ ·æœ¬3: åŸºæœ¬æ ¼å¼</button>
        </div>

        <div id="result" class="result" style="display: none;">
            <h3>è§£æç»“æœï¼š</h3>
            <div id="resultContent"></div>
        </div>

        <div id="debug" class="result" style="display: none;">
            <h3>è°ƒè¯•ä¿¡æ¯ï¼š</h3>
            <pre id="debugContent"></pre>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿè§£æå‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function parseCargoText(text) {
            const result = {};
            const debugLog = [];

            // æ ‡å‡†åŒ–æ–‡æœ¬
            const correctedText = text.replace(/\s+/g, ' ').trim();
            debugLog.push(`è¾“å…¥æ–‡æœ¬: "${text}"`);
            debugLog.push(`æ ‡å‡†åŒ–å: "${correctedText}"`);

            // 1. ä¸‰å…ƒç»„è§£æï¼š"4ä»¶/8.95æ–¹/1210kg"
            const tripleMatch = correctedText.match(/(\d+)\s*ä»¶\s*\/\s*(\d+(?:\.\d+)?)\s*æ–¹\s*\/\s*(\d+(?:\.\d+)?)\s*kg/i);
            if (tripleMatch) {
                result.pieces = parseInt(tripleMatch[1]);
                result.volume = parseFloat(tripleMatch[2]);
                result.weight = parseFloat(tripleMatch[3]);
                result.packageType = 'pieces';
                debugLog.push(`âœ… ä¸‰å…ƒç»„åŒ¹é…: ${result.pieces}ä»¶/${result.volume}æ–¹/${result.weight}kg`);
            } else {
                debugLog.push(`âŒ ä¸‰å…ƒç»„æœªåŒ¹é…`);
            }

            // 2. è¯¦ç»†å°ºå¯¸è§£æ
            const sizeMatches = correctedText.match(/(?:å°ºå¯¸)?(\d+)\s*\*\s*(\d+)\s*\*\s*(\d+)\s*\*\s*(\d+)\s*ä»¶/gi);
            if (sizeMatches) {
                debugLog.push(`âœ… å°ºå¯¸åŒ¹é…: ${sizeMatches}`);
                const dimensions = [];
                let totalPieces = 0;

                for (const match of sizeMatches) {
                    const sizeMatch = match.match(/(?:å°ºå¯¸)?(\d+)\s*\*\s*(\d+)\s*\*\s*(\d+)\s*\*\s*(\d+)\s*ä»¶/i);
                    if (sizeMatch) {
                        const dim = {
                            length: parseInt(sizeMatch[1]),
                            width: parseInt(sizeMatch[2]),
                            height: parseInt(sizeMatch[3]),
                            quantity: parseInt(sizeMatch[4])
                        };
                        dimensions.push(dim);
                        totalPieces += dim.quantity;
                        debugLog.push(`  ğŸ“ å°ºå¯¸: ${dim.length}Ã—${dim.width}Ã—${dim.height}mm, æ•°é‡: ${dim.quantity}ä»¶`);
                    }
                }

                result.dimensions = dimensions;
                debugLog.push(`ğŸ“¦ å°ºå¯¸ç´¯è®¡ä»¶æ•°: ${totalPieces}ä»¶`);

                // éªŒè¯ä»¶æ•°ä¸€è‡´æ€§
                if (result.pieces && totalPieces !== result.pieces) {
                    debugLog.push(`âš ï¸ ä»¶æ•°ä¸ä¸€è‡´: ä¸‰å…ƒç»„${result.pieces}ä»¶ vs å°ºå¯¸ç´¯è®¡${totalPieces}ä»¶`);
                }
            } else {
                debugLog.push(`âŒ å°ºå¯¸æ ¼å¼æœªåŒ¹é…`);
            }

            // 3. èµ·è¿åœ°è§£æ
            const originMatch = correctedText.match(/è´§åœ¨(.+?)(?=\s|$|ï¼Œ|ã€‚|-)/);
            if (originMatch) {
                result.origin = originMatch[1].trim();
                debugLog.push(`âœ… èµ·è¿åœ°: ${result.origin}`);
            }

            // 4. è´§ç‰©åç§°
            if (!result.name) {
                result.name = 'æ™®è´§';
                debugLog.push(`ğŸ“ é»˜è®¤è´§ç‰©åç§°: ${result.name}`);
            }

            return { result, debugLog };
        }

        function testParsing() {
            const input = document.getElementById('cargoInput').value;
            const { result, debugLog } = parseCargoText(input);

            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            const debugDiv = document.getElementById('debug');
            const debugContent = document.getElementById('debugContent');

            resultDiv.style.display = 'block';
            debugDiv.style.display = 'block';

            resultContent.innerHTML = `
                <div><strong>è´§ç‰©åç§°:</strong> ${result.name || 'æœªè¯†åˆ«'}</div>
                <div><strong>ä»¶æ•°:</strong> ${result.pieces || 0} ä»¶</div>
                <div><strong>é‡é‡:</strong> ${result.weight || 0} kg</div>
                <div><strong>ä½“ç§¯:</strong> ${result.volume || 0} cbm</div>
                <div><strong>åŒ…è£…ç±»å‹:</strong> ${result.packageType || 'æœªçŸ¥'}</div>
                <div><strong>èµ·è¿åœ°:</strong> ${result.origin || 'æœªè®¾ç½®'}</div>
                <div><strong>å°ºå¯¸æ•°é‡:</strong> ${result.dimensions ? result.dimensions.length : 0} ç§</div>
                ${result.dimensions ? '<div><strong>å°ºå¯¸è¯¦æƒ…:</strong><br>' +
                    result.dimensions.map(d => `&nbsp;&nbsp;${d.length}Ã—${d.width}Ã—${d.height}mm (${d.quantity}ä»¶)`).join('<br>') +
                '</div>' : ''}
            `;

            debugContent.textContent = debugLog.join('\n');

            // åˆ¤æ–­æˆåŠŸæˆ–å¤±è´¥
            if (result.pieces > 0) {
                resultDiv.className = 'result success';
            } else {
                resultDiv.className = 'result error';
            }
        }

        function loadSample1() {
            document.getElementById('cargoInput').value = `è´§åœ¨æ·±åœ³  -TAS  4ä»¶/8.95æ–¹/1210kg
å°ºå¯¸1336*706*2005*2ä»¶
2546*781*1300*2ä»¶
å°ºå¯¸mm`;
        }

        function loadSample2() {
            document.getElementById('cargoInput').value = `Comm è¿åŠ¨å™¨å…·
æ•°é‡ï¼š17ç®±
å°ºå¯¸ï¼šæ¯ç®±48 x 48 x 58 å˜ç±³
æ€»é‡é‡ï¼š400å…¬æ–¤`;
        }

        function loadSample3() {
            document.getElementById('cargoInput').value = `148*113*80/1
168*113*72.5/1
188.5*35.5*71/1
å•ä¸ªæ‰˜ç›˜120KG`;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            loadSample1();
            testParsing();
        };
    </script>
</body>
</html>
